{
  "example_queries": [
    {
      "question": "What is the average income by state?",
      "sql": "SELECT state_name, AVG(gross_income) AS average_income FROM households WHERE gross_income IS NOT NULL GROUP BY state_name ORDER BY state_name",
      "explanation": "Use the households table for state-level income aggregations, not household_members"
    },
    {
      "question": "Show errors by type with descriptions",
      "sql": "SELECT re.description as error_type, COUNT(*) as error_count FROM qc_errors e JOIN ref_element re ON e.element_code = re.code GROUP BY re.description ORDER BY error_count DESC",
      "explanation": "JOIN ref_element to get human-readable error type descriptions"
    },
    {
      "question": "What are the most common errors caused by agency mistakes?",
      "sql": "SELECT re.description as error_type, ra.description as cause, COUNT(*) as count FROM qc_errors e JOIN ref_element re ON e.element_code = re.code JOIN ref_agency_responsibility ra ON e.responsible_agency = ra.code WHERE ra.responsibility_type = 'agency' GROUP BY re.description, ra.description ORDER BY count DESC",
      "explanation": "Use ref_agency_responsibility.responsibility_type = 'agency' to find agency errors"
    },
    {
      "question": "Show client errors vs agency errors",
      "sql": "SELECT ra.responsibility_type, COUNT(*) as error_count, SUM(e.error_amount) as total_amount FROM qc_errors e JOIN ref_agency_responsibility ra ON e.responsible_agency = ra.code GROUP BY ra.responsibility_type",
      "explanation": "Use responsibility_type column to group by client vs agency"
    },
    {
      "question": "What income errors are most common?",
      "sql": "SELECT re.description, re.category, COUNT(*) as count FROM qc_errors e JOIN ref_element re ON e.element_code = re.code WHERE re.category IN ('earned_income', 'unearned_income') GROUP BY re.description, re.category ORDER BY count DESC",
      "explanation": "Use ref_element.category to filter by income-related error types"
    },
    {
      "question": "Show overissuance cases with status description",
      "sql": "SELECT h.case_id, h.state_name, rs.description as status, h.snap_benefit, h.amount_error FROM households h JOIN ref_status rs ON h.status = rs.code WHERE rs.description = 'Overissuance'",
      "explanation": "JOIN ref_status to query by status description instead of code"
    },
    {
      "question": "What caused the errors - unreported income or computation mistakes?",
      "sql": "SELECT rn.description as error_nature, COUNT(*) as count FROM qc_errors e JOIN ref_nature rn ON e.nature_code = rn.code WHERE rn.category IN ('income', 'computation') GROUP BY rn.description ORDER BY count DESC",
      "explanation": "Use ref_nature with category to analyze error causes"
    },
    {
      "question": "Show error summary by state with descriptions",
      "sql": "SELECT h.state_name, re.description as error_type, rf.description as finding, COUNT(*) as count FROM qc_errors e JOIN households h ON e.case_id = h.case_id AND e.fiscal_year = h.fiscal_year JOIN ref_element re ON e.element_code = re.code JOIN ref_error_finding rf ON e.error_finding = rf.code GROUP BY h.state_name, re.description, rf.description ORDER BY h.state_name, count DESC",
      "explanation": "Full JOIN pattern with households and reference tables for complete context"
    },
    {
      "question": "Show me income by state",
      "sql": "SELECT state_name, AVG(gross_income) AS avg_income FROM households GROUP BY state_name",
      "explanation": "The households table has state_name and aggregated income fields"
    },
    {
      "question": "What states have the highest income?",
      "sql": "SELECT state_name, AVG(gross_income) as avg_income FROM households WHERE gross_income IS NOT NULL GROUP BY state_name ORDER BY avg_income DESC LIMIT 10",
      "explanation": "Use households table for state-level queries"
    },
    {
      "question": "Show me all overissuance cases",
      "sql": "SELECT case_id, state_name, snap_benefit, amount_error FROM households WHERE status = 2",
      "explanation": "status = 2 means overissuance (too much benefit paid)"
    },
    {
      "question": "How many underissuance cases are there?",
      "sql": "SELECT COUNT(*) as underissuance_count FROM households WHERE status = 3",
      "explanation": "status = 3 means underissuance (too little benefit paid)"
    },
    {
      "question": "Find all wage errors",
      "sql": "SELECT e.case_id, h.state_name, e.error_amount FROM qc_errors e JOIN households h ON e.case_id = h.case_id WHERE e.element_code = 311",
      "explanation": "element_code = 311 means wages and salaries error"
    },
    {
      "question": "What are the most common error types?",
      "sql": "SELECT element_code, COUNT(*) as error_count FROM qc_errors GROUP BY element_code ORDER BY error_count DESC LIMIT 10",
      "explanation": "Element codes indicate what area had the problem (income, assets, deductions, etc.)"
    },
    {
      "question": "Show income errors by state",
      "sql": "SELECT h.state_name, COUNT(*) as income_error_count FROM qc_errors e JOIN households h ON e.case_id = h.case_id WHERE e.element_code BETWEEN 311 AND 346 GROUP BY h.state_name ORDER BY income_error_count DESC",
      "explanation": "Element codes 311-346 represent income-related errors"
    },
    {
      "question": "Find households with elderly members",
      "sql": "SELECT case_id, state_name, num_elderly, certified_household_size FROM households WHERE num_elderly > 0",
      "explanation": "num_elderly counts members age 60 and older"
    },
    {
      "question": "Show households with children receiving expedited service",
      "sql": "SELECT case_id, state_name, num_children, snap_benefit FROM households WHERE num_children > 0 AND expedited_service = 1",
      "explanation": "expedited_service = 1 means entitled and received benefits on time"
    },
    {
      "question": "Find households that were entitled to expedited service but didn't receive it on time",
      "sql": "SELECT case_id, state_name, snap_benefit FROM households WHERE expedited_service = 2",
      "explanation": "expedited_service = 2 means entitled but NOT received within Federal time frame"
    },
    {
      "question": "Show ineligible members",
      "sql": "SELECT case_id, member_number, age, snap_affiliation_code FROM household_members WHERE snap_affiliation_code NOT IN (1, 2)",
      "explanation": "snap_affiliation_code 1 or 2 are eligible; other codes indicate various ineligibility reasons"
    },
    {
      "question": "Find categorically eligible households",
      "sql": "SELECT case_id, state_name, gross_income, categorical_eligibility FROM households WHERE categorical_eligibility = 1",
      "explanation": "categorical_eligibility = 1 means exempt from SNAP income/asset tests"
    },
    {
      "question": "What's the average error amount for unreported income?",
      "sql": "SELECT AVG(error_amount) as avg_error FROM qc_errors WHERE nature_code = 35",
      "explanation": "nature_code = 35 means unreported source of income"
    },
    {
      "question": "Show asset errors by state",
      "sql": "SELECT h.state_name, COUNT(*) as asset_errors FROM qc_errors e JOIN households h ON e.case_id = h.case_id WHERE e.element_code IN (211, 221, 222) GROUP BY h.state_name",
      "explanation": "Element codes 211 (bank accounts), 221 (real property), 222 (vehicles) are asset errors"
    },
    {
      "question": "Find households with SSI recipients",
      "sql": "SELECT m.case_id, h.state_name, m.member_number, m.ssi FROM household_members m JOIN households h ON m.case_id = h.case_id WHERE m.ssi > 0",
      "explanation": "SSI (Supplemental Security Income) is tracked at member level"
    },
    {
      "question": "What's the total error amount for each state?",
      "sql": "SELECT h.state_name, SUM(e.error_amount) as total_error_amount FROM qc_errors e JOIN households h ON e.case_id = h.case_id GROUP BY h.state_name ORDER BY total_error_amount DESC",
      "explanation": "Join qc_errors to households to get state_name for geographic analysis"
    },
    {
      "question": "Show male vs female household members",
      "sql": "SELECT sex, COUNT(*) as count FROM household_members WHERE sex IN (1, 2) GROUP BY sex",
      "explanation": "sex codes: 1=Male, 2=Female"
    },
    {
      "question": "Find computation errors by state",
      "sql": "SELECT h.state_name, COUNT(*) as computation_errors FROM qc_errors e JOIN households h ON e.case_id = h.case_id WHERE e.element_code = 520 OR e.nature_code = 75 GROUP BY h.state_name",
      "explanation": "element_code 520 = arithmetic computation, nature_code 75 = benefit incorrectly computed"
    },
    {
      "question": "What's the average SNAP benefit by household size?",
      "sql": "SELECT certified_household_size, AVG(snap_benefit) as avg_benefit FROM households WHERE snap_benefit IS NOT NULL GROUP BY certified_household_size ORDER BY certified_household_size",
      "explanation": "certified_household_size is the number of people in the household"
    }
  ]
}
